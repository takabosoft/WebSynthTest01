(()=>{"use strict";var e={705:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initSynthPatch=t.initOperatorsParams=t.initOperatorParams=void 0;const o=a(853);t.initOperatorParams={frequencyRatio:1,frequencyOffsetHz:0,sendDepths:[0,0,0,0,0,0],ampEnvelope:o.initEnvelopeParams,volume:0,pan:0},t.initOperatorsParams=[Object.assign(Object.assign({},t.initOperatorParams),{volume:1}),t.initOperatorParams,t.initOperatorParams,t.initOperatorParams,t.initOperatorParams,t.initOperatorParams],t.initSynthPatch={name:"Init",operatorsParams:t.initOperatorsParams,bendRange:2,modulationFrequency:5}},853:(e,t)=>{function a(e,t,a,o,s,n){if(n<e||n>a)return;const r=function(e,t){return 0===t?e:t>0?Math.pow(e,1+t):1-Math.pow(1-e,1-t)}((n-e)/(a-e),s);return t*(1-r)+o*r}Object.defineProperty(t,"__esModule",{value:!0}),t.initEnvelopeParams=t.shapeMax=t.shapeMin=void 0,t.interpolate=a,t.calcEnvelope=function e(t,o,s){var n;if(null!=s&&o>=s){if(0==t.releaseSec)return 0;const r=s;return a(r,null!==(n=e(t,s,void 0))&&void 0!==n?n:0,r+t.releaseSec,0,t.releaseShape,o)}return o<t.attackSec?a(0,0,t.attackSec,1,t.attackShape,o):o<t.attackSec+t.decaySec?a(t.attackSec,1,t.attackSec+t.decaySec,t.sustain,t.decayShape,o):t.sustain},t.shapeMin=-10,t.shapeMax=10,t.initEnvelopeParams={attackSec:0,attackShape:0,decaySec:0,decayShape:0,sustain:1,releaseSec:0,releaseShape:0}},311:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fadeSecForClickNoise=t.operatorCount=void 0,t.convertOperatorParamsToEx=function(e){return Object.assign(Object.assign({},e),{ampEnvelope:Object.assign(Object.assign({},e.ampEnvelope),{attackSec:Math.max(e.ampEnvelope.attackSec,t.fadeSecForClickNoise),releaseSec:Math.max(e.ampEnvelope.releaseSec,t.fadeSecForClickNoise)}),sleep:e.sendDepths.every((e=>0==e))&&0==e.volume})},t.operatorCount=6,t.fadeSecForClickNoise=.001},579:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SynthNote=void 0;const o=a(853),s=a(311),n=2*Math.PI;function r(e,t,a){a[0]+=e*(1-t)/2,a[1]+=e*(1+t)/2}class i{constructor(){this.phase=0}getValue(e=0){return Math.sin(this.phase*n+e)}addPhase(e){this.phase+=e/sampleRate,this.phase%=1}}class c{constructor(e){this.params=e,this.oldOpValue=0,this.newOpValue=0,this.waveformGen=new i}}t.SynthNote=class{constructor(e,t){this.note=e,this.patch=t,this.mod=new i,this._sampleIndex=0,this.operators=t.operatorsParams.map((e=>new c(e)))}get sampleIndex(){return this._sampleIndex}get curSec(){return this._sampleIndex/sampleRate}generateSample(e,t,a){const n=(i=this.note+t+this.mod.getValue()*a,440*Math.pow(2,(i-69)/12));var i;this.mod.addPhase(this.patch.modulationFrequency);const c=this.curSec;let h=!1;for(let t=0;t<this.operators.length;t++){const a=this.operators[t],i=a.params;if(i.sleep)continue;const p=this.operators.reduce(((e,a)=>e+a.params.sendDepths[t]*a.oldOpValue),0);if(a.newOpValue=a.waveformGen.getValue(p),i.volume>0){const t=(0,o.calcEnvelope)(i.ampEnvelope,c,this.noteOffSec);if(null!=t)if(null!=this.fadeOutStartSec){const n=(0,o.interpolate)(this.fadeOutStartSec,1,this.fadeOutStartSec+s.fadeSecForClickNoise,0,0,c);null!=n&&(h=!0,r(a.newOpValue*t*n*i.volume,i.pan,e))}else h=!0,r(a.newOpValue*t*i.volume,i.pan,e)}a.waveformGen.addPhase(n*i.frequencyRatio+i.frequencyOffsetHz)}for(const e of this.operators)e.oldOpValue=e.newOpValue;return this._sampleIndex++,h}updatePatch(e){this.patch=e,this.operators.forEach(((t,a)=>t.params=e.operatorsParams[a]))}}},901:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertSynthPatchToEx=function(e){return{name:e.name,operatorsParams:[(0,o.convertOperatorParamsToEx)(e.operatorsParams[0]),(0,o.convertOperatorParamsToEx)(e.operatorsParams[1]),(0,o.convertOperatorParamsToEx)(e.operatorsParams[2]),(0,o.convertOperatorParamsToEx)(e.operatorsParams[3]),(0,o.convertOperatorParamsToEx)(e.operatorsParams[4]),(0,o.convertOperatorParamsToEx)(e.operatorsParams[5])],bendRange:e.bendRange,modulationFrequency:e.modulationFrequency}};const o=a(311)},955:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SynthProcessor=void 0;const o=a(705),s=a(579),n=a(901);class r extends AudioWorkletProcessor{constructor(){super(),this.synthNoteMap=new Map,this.fadeOutNotes=[],this.synthPatchEx=(0,n.convertSynthPatchToEx)(o.initSynthPatch),this.polyphony=2,this.pitchBend=0,this.modulation=0,this.listenMessages()}get oldestNote(){let e,t=0;for(const[a,o]of this.synthNoteMap.entries())(null==e||t<o.sampleIndex)&&(e=a,t=o.sampleIndex);return e}process(e,t,a){const o=t[0],s=o[0],n=o[1],r=this.pitchBend*this.synthPatchEx.bendRange,i=this.modulation,c=[0,0];for(let e=0;e<s.length;e++){c[0]=c[1]=0;for(const e of Array.from(this.synthNoteMap.values()))e.generateSample(c,r,i)||this.synthNoteMap.delete(e.note);for(let e=this.fadeOutNotes.length-1;e>=0;e--)this.fadeOutNotes[e].generateSample(c,r,i)||this.fadeOutNotes.splice(e);s[e]=c[0],n[e]=c[1]}return!0}listenMessages(){this.port.onmessage=e=>{const t=e.data;switch(t.type){case"NoteOn":this.onNoteOn(t.note);break;case"NoteOff":this.onNoteOff(t.note);break;case"PitchBend":this.pitchBend=t.pitchBend;break;case"Modulation":this.modulation=t.modulation;break;case"Patch":this.onPatch(t.patch);break;case"Polyphony":this.onPolyphony(t.polyphony)}}}fadeOutNote(e){const t=this.synthNoteMap.get(e);null!=t&&(t.fadeOutStartSec=t.curSec,this.fadeOutNotes.push(t),this.synthNoteMap.delete(e))}checkPolyphony(){for(;this.polyphony<this.synthNoteMap.size;){const e=this.oldestNote;if(null==e)break;this.fadeOutNote(e)}}onNoteOn(e){const t=this.synthNoteMap.get(e);null!=t&&null==t.noteOffSec||(null!=t&&null!=t.noteOffSec&&this.fadeOutNote(e),this.synthNoteMap.set(e,new s.SynthNote(e,this.synthPatchEx)),this.checkPolyphony())}onNoteOff(e){const t=this.synthNoteMap.get(e);null!=t&&null==t.noteOffSec&&(t.noteOffSec=t.curSec)}onPatch(e){this.synthPatchEx=(0,n.convertSynthPatchToEx)(e);for(const e of this.synthNoteMap.values())e.updatePatch(this.synthPatchEx);this.fadeOutNotes.forEach((e=>e.updatePatch(this.synthPatchEx)))}onPolyphony(e){this.polyphony=e,this.checkPolyphony()}}t.SynthProcessor=r}},t={};function a(o){var s=t[o];if(void 0!==s)return s.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,a),n.exports}(()=>{const e=a(955);registerProcessor("SynthProcessor",e.SynthProcessor)})()})();